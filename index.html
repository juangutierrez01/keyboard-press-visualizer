<!DOCTYPE html>
<html>
  <head>
    <title>keyboard</title>
  </head>
  <body style="margin:0;overflow:hidden">
    <canvas style="display:block"></canvas>
    <script>
/****************************************************************************/
const canvas = document.querySelector("canvas");
const context = canvas.getContext("2d");

// Total width and total height of keys for scaling
const TOTAL_WIDTH = 13.5;
const TOTAL_HEIGHT = 4;

// Light mode / dark mode colors
const LIGHT_MODE_BACKGROUND = "rgb(255 255 255 / 8%)";
const DARK_MODE_BACKGROUND = "rgb(0 0 0 / 8%)";
const LIGHT_MODE_KEY = "white"
const DARK_MODE_KEY = "black"
let backgroundColor;
let keyColor;

// Set of keys pressed down at any moment
const keysPressed = new Set();

// Spatial mapping of key codes to areas on the screen
const keyMap = (function generateKeyMap() {
  const keyMap = new Map([
    [
      'Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5', 'Digit6', 'Digit7',
      'Digit8', 'Digit9', 'Digit0', 'Minus', 'Equal', 'Backspace'
    ],
    [
      'KeyQ', 'KeyW', 'KeyE', 'KeyR', 'KeyT', 'KeyY', 'KeyU', 
      'KeyI', 'KeyO', 'KeyP', 'BracketLeft', 'BracketRight', 'Backslash'
    ],
    [
      'KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyG', 'KeyH', 'KeyJ',
      'KeyK', 'KeyL', 'Semicolon', 'Quote', 'Enter'
    ],
    [
      'KeyZ', 'KeyX', 'KeyC', 'KeyV', 'KeyB', 'KeyN', 'KeyM',
      'Comma', 'Period', 'Slash', 'ShiftRight'
    ]
  ]
    .flatMap((row, rowIndex) => 
      row
        .map((key, keyIndex) =>
          [key, [keyIndex + 0.5*rowIndex, rowIndex, 1]]
        )
    )
  );
    
  ["KeyQ", "KeyA", "KeyZ"].forEach((key, rowIndex) => {
    keyMap.get(key)[0] = 0;
    keyMap.get(key)[2] = 1.5 + 0.5*rowIndex;
  });

  keyMap.get("Backspace")[2] = 1.5;
  keyMap.get("Enter")[2] = 1.5;
  keyMap.get("ShiftRight")[2] = 2;

  return keyMap;
})();

// Record any keys pressed
window.addEventListener("keydown", (event) => {
  if (keyMap.has(event.code)) {
    keysPressed.add(event.code);
  }
});

// Record any keys released
window.addEventListener("keyup", (event) => {
  keysPressed.delete(event.code);
});

// React to dark/light mode
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (function toggleDarkMode(event) {
  backgroundColor = event.matches ? DARK_MODE_BACKGROUND : LIGHT_MODE_BACKGROUND;
  keyColor = event.matches ? LIGHT_MODE_KEY : DARK_MODE_KEY;
  return toggleDarkMode;
})(window.matchMedia("(prefers-color-scheme: dark)")));

// Resize canvas when page is resized
window.addEventListener("resize", (function resizeCanvas() {
    canvas.width = document.documentElement.clientWidth;
    canvas.height = document.documentElement.clientHeight;
    
    // Initialize the background color to prevent
    // drawn keys from leaving a permanent shadow
    context.fillStyle = keyColor;
    context.fillRect(0, 0, canvas.width, canvas.height);
    context.fillStyle = backgroundColor;
    for (let i = 0; i < 64; ++i) {
      context.fillRect(0, 0, canvas.width, canvas.height);
    }

    return resizeCanvas;
})());

// Display detected keys spatially to screen
window.requestAnimationFrame(function draw() {
  window.requestAnimationFrame(draw);

  // Fade the whole screen
  context.fillStyle = backgroundColor;
  context.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw any keys detected
  context.fillStyle = keyColor;

  for (const key of keysPressed) {
    const [x, y, w] = keyMap.get(key);
    context.fillRect(
      x * canvas.width / TOTAL_WIDTH,
      y * canvas.height / TOTAL_HEIGHT,
      w * canvas.width / TOTAL_WIDTH,
      canvas.height / TOTAL_HEIGHT
    );
  }
});
/****************************************************************************/
    </script>
  </body>
</html>